<!DOCTYPE html>
<html lang="en">
  <head>
    <title>FP KAMAR COWO in 3D</title>
  </head>
  <body style="background-color: rgb(245, 245, 245)"></body>
</html>
<script type="module">
  import * as THREE from "https://threejsfundamentals.org/threejs/resources/threejs/r132/build/three.module.js";
  import { OrbitControls } from "https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/controls/OrbitControls.js";
  import { GLTFLoader } from "https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/loaders/GLTFLoader.js";
  import * as dat from "https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/libs/dat.gui.module.js";

  let scene,
    camera,
    renderer,
    shepre,
    target,
    texture,
    light,
    light1,
    light2,
    light3,
    light4,
    light5,
    light6,
    cube,
    lightHelper1,
    lightHelper2,
    lightHelper3,
    lightHelper4,
    lightHelper5,
    lightHelper6,
    plane,
    geometry,
    material,
    mixer;
  let sphere_dalam, controls, root;
  var clock = new THREE.Clock();
  let ADD = 0.001,
    theta = 0;
  const gui = new dat.GUI();

    class FogGUIHelper {
      constructor(light1, light2, light3, light4) {
          this.light1 = light1;
          this.light2 = light2;
          this.light3 = light3;
          this.light4 = light4;
      }
      get color() {
          return `#${this.light1.color.getHexString()}`;
      }
      set color(hexString) {
          this.light1.color.set(hexString);
          this.light1.set(hexString);
      }
      get color2() {
          return `#${this.light2.color.getHexString()}`;
      }
      set color2(hexString) {
          this.light2.color2.set(hexString);
          this.light2.set(hexString);
      }
    }

  //memuat gltf kamar
  let createGeometry = function () {
    const gltfLoader1 = new GLTFLoader();
    const url1 = "blender/kamar06.gltf";
    gltfLoader1.load(url1, (gltf) => {
      gltf.scene.scale.set(0.1, 0.1, 0.1);
      root = gltf.scene;
      mixer = new THREE.AnimationMixer(gltf.scene);

      gltf.animations.forEach((clip) => {
        mixer.clipAction(clip).play();
      });
      root.position.set(0, 0, 0);
      root.encoding = THREE.LinearEncoding;
      scene.add(root);

      //buat shadow dari objectnya
      root.traverse((obj) => {
        if (obj.castShadow !== undefined) {
          obj.castShadow = true;
          obj.receiveShadow = true;
        }
      });

      root.loadedModel.animations.forEach((animation) => {
        let mixer = new AnimationMixer(this.loadedModel.scene);
        this.mixers.push(mixer);
        let action = mixer.clipAction(animation);
        action.play();
      });
    });
  };

  // set up the environment -
  // initiallize scene, camera, objects and renderer

  let init = function () {
    // 1. create the scene
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xfefbf3);

    // const axesHelper = new THREE.AxesHelper(15);
    // scene.add(axesHelper);

    //fog
    // const near = 1;
    // const far = 100;
    const color = "white";

    scene.fog = new THREE.Fog(color, 1, 50);

    //fog helper
    const fogGUIHelper = new FogGUIHelper(light1, light2, light3, light4);
    // gui.add(fogGUIHelper, "near", near, far).listen();
    // gui.add(fogGUIHelper, "far", near, far).listen();
    gui.addColor(fogGUIHelper, "color");
    gui.addColor(fogGUIHelper, "color2"); // 2. create an locate the camera

    camera = new THREE.PerspectiveCamera(
      60,
      window.innerWidth / window.innerHeight,
      1,
      1000
    );
    camera.position.set(-5, 3, -3);

    // scene.add(new THREE.CameraHelper(camera));

    // light = new THREE.AmbientLight(0xffffff, 0); // ceritanya cahaya natural
    // scene.add(light);

    light1 = new THREE.DirectionalLight(0x230bff, 6); // ceritanya lampu biru kanan
    light1.position.set(-3.85, 3, 0.23);
    let t1 = new THREE.Object3D();
    t1.translateX(0);
    t1.translateY(0.6);
    t1.translateZ(0.35);
    light1.target = t1;

    light2 = new THREE.DirectionalLight(0xc050ff, 6); // ceritanya lampu violet kanan
    light2.position.set(1, 2.5, -2.5);

    let t2 = new THREE.Object3D();
    t2.translateX(-0.45);
    t2.translateY(1.1);
    t2.translateZ(0.1);
    light2.target = t2;

    light3 = new THREE.DirectionalLight(0xffffff, 1); // ceritanya lampu putih atas
    light3.position.set(-0.8, 5, 0);

    light4 = new THREE.DirectionalLight(0xffffff, 1); // ceritanya lampu putih pojok kanan kursi
    light4.position.set(-3.5, 2.5, -3);
    let t4 = new THREE.Object3D();
    t4.translateX(0.5);
    light4.target = t4;

    // light5 = new THREE.DirectionalLight(0xffffff, 0.5); // ceritanya lampu biru kanan
    // light5.position.set(0, 10, -5);

    // light6 = new THREE.DirectionalLight(0xffffff, 0.5); // ceritanya lampu biru kanan
    // light6.position.set(-5, 10, 0);

    // const spotLight = new THREE.SpotLight(0xffffff);
    // spotLight.position.set(0, 9, 0);

    // spotLight.castShadow = true;

    // spotLight.shadow.mapSize.width = 50;
    // spotLight.shadow.mapSize.height = 50;

    // spotLight.shadow.camera.near = 50;
    // spotLight.shadow.camera.far = 40;
    // spotLight.shadow.camera.fov = 30;

    // scene.add(spotLight);

    //shadow
    light1.castShadow = true;
    light1.shadow.radius = 3;
    light1.target.updateMatrixWorld();
    scene.add(light1.target);
    scene.add(light1);

    light2.castShadow = true;
    light2.shadow.radius = 3;
    light2.target.updateMatrixWorld();
    scene.add(light2.target);
    scene.add(light2);

    light3.castShadow = true;
    light3.shadow.radius = 8;
    scene.add(light3);

    light4.castShadow = true;
    light4.shadow.radius = 2;
    light4.target.updateMatrixWorld();
    scene.add(light4.target);
    scene.add(light4);

    // light5.castShadow = true;
    // light5.shadow.radius = 1;
    // scene.add(light5);

    // light6.castShadow = true;
    // light6.shadow.radius = 1;
    // scene.add(light6);
    // 3. create an locate the object on the scene

    // lightHelper1 = new THREE.DirectionalLightHelper(light1, 1, 0x000000);
    // scene.add(lightHelper1);

    // lightHelper2 = new THREE.DirectionalLightHelper(light2, 1, 0x000000);
    // lightHelper2.update();
    // scene.add(lightHelper2);

    // lightHelper3 = new THREE.DirectionalLightHelper(light3, 1, 0x000000);
    // scene.add(lightHelper3);

    // lightHelper4 = new THREE.DirectionalLightHelper(light4, 1, 0x000000);
    // scene.add(lightHelper4);

    // lightHelper5 = new THREE.DirectionalLightHelper(light5, 3, 0x000000);
    // scene.add(lightHelper5);

    // lightHelper6 = new THREE.DirectionalLightHelper(light6, 3, 0x000000);
    // scene.add(lightHelper6);

    // const spotLightHelper = new THREE.SpotLightHelper(spotLight);
    // scene.add(spotLightHelper);

    createGeometry(); // 4. create the renderer
    renderer = new THREE.WebGLRenderer({ antialiasing: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMapSoft = true;
    renderer.shadowMap.type = THREE.VSMShadowMap; //jenis bayangan yng dipakai
    renderer.receiveShadow = true;
    // renderer.outputEncoding = THREE.sRGBEncoding;

    //mencerahkan hasil load gltf
    renderer.physicallyCorrectLights = true;
    renderer.gammaOutput = true;
    renderer.gammaFactor = 2.2;

    document.body.appendChild(renderer.domElement);

    // controls
    controls = new OrbitControls(camera, renderer.domElement);
    controls.listenToKeyEvents(window);

    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
  }; // main animation loop - calls 50-60 in a second.
  let mainLoop = function () {
    renderer.render(scene, camera);
    controls.update();
    requestAnimationFrame(mainLoop);
  }; ///////////////////////////////////////////////
  function animate() {
    requestAnimationFrame(animate);

    var delta = clock.getDelta();

    if (mixer) mixer.update(delta);

    renderer.render(scene, camera);
  }

  init();
  animate();
  mainLoop();
</script>
